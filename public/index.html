<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MultiChat Overlay</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --twitch:   #9146FF;
    --youtube:  #FF0000;
    --kick:     #53FC18;
    --joystick: #00E5FF;
    --bg:       rgba(0, 0, 0, 0);
    --msg-bg:   rgba(15, 15, 20, 0.82);
    --radius:   10px;
    --font:     'Nunito', sans-serif;
  }

  html, body {
    background: transparent;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    font-family: var(--font);
  }

  #chat {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 12px 10px;
    display: flex;
    flex-direction: column-reverse;
    gap: 6px;
    max-height: 100vh;
    overflow: hidden;
  }

  .msg {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    background: transparent;
    animation: slideIn 0.25s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    max-width: 100%;
    word-break: break-word;
    line-height: 1.4;
    flex-wrap: wrap;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-16px) scale(0.97); }
    to   { opacity: 1; transform: translateX(0) scale(1); }
  }

  .platform-icon {
    width: 32px;
    height: 32px;
    flex-shrink: 0;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .platform-icon svg {
    width: 26px;
    height: 26px;
  }

  .username {
    font-weight: 800;
    font-size: 23px;
    color: #fff;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    flex-shrink: 0;
  }

  .badge {
    width: 26px;
    height: 26px;
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    filter: drop-shadow(-1px -1px 0 #000) drop-shadow(1px -1px 0 #000) drop-shadow(-1px 1px 0 #000) drop-shadow(1px 1px 0 #000);
  }
  .badge svg { width: 26px; height: 26px; }

  .msg-text {
    font-size: 26px;
    color: rgba(255,255,255,0.92);
    font-weight: 600;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
  }

  /* Colon separator between username and message */
  .username::after {
    content: ':';
    color: rgba(255,255,255,0.4);
    font-weight: 600;
  }

  /* Platform colors */
  .platform-twitch   { --platform-color: var(--twitch); }
  .platform-youtube  { --platform-color: var(--youtube); }
  .platform-kick     { --platform-color: var(--kick); }
  .platform-joystick { --platform-color: var(--joystick); }

  .platform-twitch   .platform-icon { background: var(--twitch); }
  .platform-youtube  .platform-icon { background: var(--youtube); }
  .platform-kick     .platform-icon { background: rgba(83,252,24,0.15); border: 1px solid var(--kick); }
  .platform-joystick .platform-icon { background: rgba(0,229,255,0.15); border: 1px solid var(--joystick); }

  /* SVG icons */
  .icon-twitch   { fill: white; }
  .icon-youtube  { fill: white; }
  .icon-kick     { fill: #53FC18; }
  .icon-joystick { fill: #00E5FF; }

  .fade-out {
    animation: fadeOut 0.4s ease forwards;
  }
  @keyframes fadeOut {
    to { opacity: 0; transform: translateX(-10px); height: 0; padding: 0; margin: 0; }
  }
</style>
</head>
<body>
<div id="chat"></div>

<script>
// SVG icons per platform
const ICONS = {
  twitch: `<svg viewBox="0 0 24 24" class="icon-twitch"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/></svg>`,
  youtube: `<svg viewBox="0 0 24 24" class="icon-youtube"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>`,
  kick: `<svg viewBox="0 0 24 24" class="icon-kick"><path d="M3 2h3.5v8l5-8H16l-6 9.5 6.5 10.5H12l-5.5-8.5V22H3V2z"/></svg>`,
  joystick: `<img src="data:image/png;base64,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" style="width:26px;height:26px;object-fit:contain;" />`,
};

// SVG badge icons
const BADGE_ICONS = {
  mod:        `<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 2L3 6v4c0 4.4 3 8.5 7 9.9 4-1.4 7-5.5 7-9.9V6L10 2z" fill="#00ADF0"/><path d="M8 10.5L9.5 12 13 8.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
  sub:        `<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 2l2.09 4.26L17 7.27l-3.5 3.41.83 4.82L10 13.1l-4.33 2.4.83-4.82L3 7.27l4.91-.71L10 2z" fill="#9146FF"/><path d="M10 2l2.09 4.26L17 7.27l-3.5 3.41.83 4.82L10 13.1l-4.33 2.4.83-4.82L3 7.27l4.91-.71L10 2z" stroke="#c49eff" stroke-width="0.5"/></svg>`,
  vip:        `<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="5" width="16" height="10" rx="3" fill="#FFAA00"/><text x="10" y="13.5" text-anchor="middle" font-size="7" font-weight="bold" font-family="Arial" fill="white">VIP</text></svg>`,
  owner:      `<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 2l2 5h5l-4 3 1.5 5L10 12l-4.5 3L7 10 3 7h5L10 2z" fill="#FF6B35"/><path d="M10 2l2 5h5l-4 3 1.5 5L10 12l-4.5 3L7 10 3 7h5L10 2z" stroke="#ffa07a" stroke-width="0.5"/></svg>`,
  member:     `<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="8" fill="#53FC18" fill-opacity="0.3" stroke="#53FC18" stroke-width="1.5"/><path d="M7 10l2 2 4-4" stroke="#53FC18" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
  broadcaster:`<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 2l2 5h5l-4 3 1.5 5L10 12l-4.5 3L7 10 3 7h5L10 2z" fill="#FF6B35"/></svg>`,
  streamer:   `<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 2l2 5h5l-4 3 1.5 5L10 12l-4.5 3L7 10 3 7h5L10 2z" fill="#FF6B35"/></svg>`,
};
BADGE_ICONS.moderator = BADGE_ICONS.mod;
BADGE_ICONS.subscriber = BADGE_ICONS.sub;

const MAX_MESSAGES = 30;
const MSG_LIFETIME_MS = 0; // 0 = messages stay forever

const chat = document.getElementById('chat');
const timers = new Map();

function addMessage({ platform, username, message, color, badges }) {
  // Remove oldest if over limit
  const msgs = chat.querySelectorAll('.msg');
  if (msgs.length >= MAX_MESSAGES) {
    const oldest = msgs[msgs.length - 1];
    removeMessage(oldest);
  }

  const div = document.createElement('div');
  div.className = `msg platform-${platform}`;

  // Badges HTML
  const badgeHtml = (badges || [])
    .filter(b => BADGE_ICONS[b])
    .map(b => `<span class="badge" title="${b}">${BADGE_ICONS[b]}</span>`)
    .join('');

  const nameColor = color ? `style="color:${color}"` : '';

  div.innerHTML = `
    <div class="platform-icon">${ICONS[platform] || ''}</div>
    ${badgeHtml}
    <span class="username" ${nameColor}>${escapeHtml(username)}</span>
    <span class="msg-text">${escapeHtml(message)}</span>
  `;

  chat.prepend(div);

  // Auto-remove after lifetime
  if (MSG_LIFETIME_MS > 0) {
    const timer = setTimeout(() => removeMessage(div), MSG_LIFETIME_MS);
    timers.set(div, timer);
  }
}

function removeMessage(el) {
  if (!el || !el.parentNode) return;
  clearTimeout(timers.get(el));
  timers.delete(el);
  el.classList.add('fade-out');
  setTimeout(() => el.remove(), 400);
}

function escapeHtml(str) {
  return str
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

// Connect to backend socket
const socket = io();

socket.on('chat_message', (data) => {
  addMessage(data);
});

socket.on('connect', () => console.log('Connected to MultiChat server'));
socket.on('disconnect', () => console.log('Disconnected from MultiChat server'));
</script>
</body>
</html>
